# Техническое задание на разработку расширения для УТ 11.5: Автоматическое разбиение заказа по доступности товаров


**Версия ТЗ:** 1.0
**Статус:** В работе

## 1. Общие сведения

| Параметр | Значение / Описание |
|----------|---------------------|
| **Конфигурация** | 1С:Управление торговлей, редакция 11.5 (11.5.Х.ХХХ) |
| **Режим совместимости** | Не ниже "Версия 8.3.27" |
| **Способ доработки** | **Расширение**  |
| **Наименование расширения** | `на усмотрение` |
| **Префикс объектов** | `на усмотрение` |

## 2. Основание для разработки

Автоматизация процесса распределения товаров из коммерческого предложения (заказа клиента) по различным заказам клиентов в зависимости от наличия товаров на складах, их производителя и настроек обеспечения, с целью оптимизации логистики и ускорения обработки заказов.

## 3. Цель и назначение

*   **Цель:** Автоматизировать процесс разделения коммерческого предложения на несколько заказов клиентов по правилам доступности товаров и настроек обеспечения.
*   **Назначение:** Функционал предназначен для менеджеров отдела продаж.

## 4. Функциональные требования

### 4.1 Настройки обработки разбиения

*   **1.1:** В расширении должен быть создан **справочник или регистр** для хранения параметров по умолчанию. Он уже определен, с  наименованием.
    **1.2:** Должен содержать как минимум следующие реквизиты (значения заполняются вручную):
    *   Настройки товара в заказе клиента :
          - Действие (Не обеспечивать, К обеспечению, Резервировать на складе)
          - Обособленно
    * Список складов для просмотра, обхода в циклах:
        - `Производитель ИФЗ`
        - `Организация продавец в ИФЗ`
        - `Договор продавца ИФЗ`
        - `Список складов ИФЗ`
        - `Организация продавец`
        - `Договор продавца`
        - `Склад продавца`
### 4.2. Интерфейсная кнопка и основная логика

*   **2.1:** На форму документа **"Коммерческое предложение"** добавить кнопку **"Разбить заказ"**.
*   **2.2:** При нажатии на кнопку запускается алгоритм разбиения, описанный ниже.

### 4.3. Обработка доступных товаров
*   **3.1** Группируем товары по Доступности на складах из списка складов.
  * **3.2** Отбираем товары, которые доступны. 
  * **3.3** Фильтруем по производителю ИФЗ. 
  * **3.4** В алфавитном порядке сортируем Список складов ИФЗ и делим товары в доступности.
  * **3.5** На каждую группу создаем заказ клиента с реквизитом склада, Организация продавец в ИФЗ, Договор продавца ИФЗ .
  * **3.6** То же самое делаем с остальными товарами. 
  * **3.7** Обеспечение товаров заполняем из настроек.
  * **3.8** Дозаполняем, если само не ставится, менеджер, сделка, комментарии . 
  * **3.9** Отсутствующие товары(не попавшие в заказы и/или их количество) на складах заносим в новое коммерческое предложение, в начало комментария добавляем "Отсутствует на складе".
  * **3.10** Проводим документы, в случае ошибки выводим пользователю сообщение об ошибке. Не должна прерываться аварийно.  В случае успешного проведения всех документов вывести пользователю информационное сообщение с перечнем созданных и проведенных документов (номера и ссылки).

  ## 5. PS
  Алгоритм работы, обсуждался много раз и может оставаться прежним, и должен выполнять функционал, который и сейчас работает.