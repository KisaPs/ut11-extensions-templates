# Техническое задание на разработку расширения для УТ 11.5: Обмен с сайтом. Загрузка заказов.

**Код проекта:** `UT11_EXT_WebsiteOrders`
**Версия ТЗ:** 1.0
**Статус:** Черновик

## 1. Общие сведения

| Параметр | Значение / Описание |
|----------|---------------------|
| **Конфигурация** | 1С:Управление торговлей, редакция 11.5 (11.5.Х.ХХХ) |
| **Режим совместимости** | Не ниже "Версия 8.3.12" |
| **Способ доработки** | **Расширение** (Configuration Extension) |
| **Наименование расширения** | `РасширениеДляУТ_ОбменССайтом` |
| **Префикс объектов** | `РУТ_Обмен_` |
| **Ответственный разработчик** | *[ФИО]* |
| **Дата начала** | *[Дата]* |
| **Дата окончания (план)** | *[Дата]* |
| **Дата окончания (факт)** | *[Дата]* |

## 2. Основание для разработки

Автоматизация процесса приема заказов с интернет-сайта компании для исключения ручного ввода данных, минимизации ошибок и ускорения обработки входящих заявок.

## 3. Цель и назначение

*   **Цель:** Автоматизировать создание документов "Сделка" и "Коммерческое предложение" в УТ 11.5 на основе данных, полученных с внешнего сайта.
*   **Назначение:** Функционал предназначен для использования менеджерами отдела продаж, отделом маркетинга и службой поддержки.

## 4. Функциональные требования

### 4.1. Хранение и настройка параметров обмена

*   **FR-1.1:** В расширении должен быть создан **справочник "Настройки обмена с сайтом"** (`РУТ_Обмен_Настройки`) для хранения параметров по умолчанию.
*   **FR-1.2:** Справочник должен содержать как минимум следующие реквизиты (значения заполняются вручную):
    *   `СоглашениеПоУмолчанию` (СправочникСсылка.СоглашенияСКонтрагентами)
    *   `КлиентПоУмолчанию` (СправочникСсылка.Контрагенты)
    *   `ОрганизацияПоУмолчанию` (СправочникСсылка.Организации)
    *   `ОтветственныйПоУмолчанию` (СправочникСсылка.Пользователи)
*   **FR-1.3:** Должна быть создана **обработка "Настройка параметров загрузки заказов"** (`РУТ_Обмен_НастройкаПараметров`) для удобного редактирования записей справочника из интерфейса.

### 4.2. Прием и обработка входящих данных

*   **FR-2.1:** Должна быть создана **обработка "Загрузка заказов с сайта"** (`РУТ_Обмен_ЗагрузкаЗаказов`).
*   **FR-2.2:** Обработка должна предоставлять интерфейс для ручного выбора файла данных (в формате JSON или XML) или указания URL веб-сервиса сайта.
*   **FR-2.3:** Структура входящих данных должна содержать массив заказов. Каждый заказ содержит:
    *   `Номер` (Строка) - внешний номер заказа с сайта.
    *   `Имя` (Строка) - название/комментарий к заказу.
    *   `КлиентИНН` (Строка, *опционально*) - ИНН контрагента.
    *   `Товары` (Массив) - список товарных позиций. Каждая позиция содержит `Код` (артикул) и `Количество`.

### 4.3. Создание документов в УТ 11.5

#### Создание Сделки
*   **FR-3.1:** Для каждого заказа из входящих данных необходимо создать документ **"Сделка"**.
*   **FR-3.2:** Реквизиты Сделки заполняются следующим образом:
    *   **Наименование:** `Номер + " " + Имя` (значения из входящих данных).
    *   **Контрагент (Клиент):** Определяется **автоматически** путем поиска в справочнике "Контрагенты" по полю `ИНН`, равному значению `КлиентИНН` из входящих данных.
        *   Если контрагент найден - он подставляется.
        *   Если не найден - используется значение `КлиентПоУмолчанию` из настроек.
    *   **Соглашение:** Значение `СоглашениеПоУмолчанию` из настроек.
    *   **Ответственный:** Значение `ОтветственныйПоУмолчанию` из настроек.
    *   **Комментарий:** `"Загружено с сайта. Внешний номер: [Номер]"`.

#### Создание Коммерческого предложения (КП)
*   **FR-4.1:** На основании созданной Сделки должно быть автоматически создано **"Коммерческое предложение"**.
*   **FR-4.2:** Реквизиты КП заполняются следующим образом:
    *   **Соглашение:** Подставляется из Сделки (равно значению из настроек).
    *   **Вид цены:** Определяется автоматически из поля **"Вид цен"** выбранного Соглашения.
    *   **Менеджер:** Подставляется `ОтветственныйПоУмолчанию` из настроек (совпадает с ответственным по сделке).
    *   **Организация:** Значение `ОрганизацияПоУмолчанию` из настроек.
    *   **Склад:** *[Примечание: Требуется уточнение. Брать из Соглашения/Организации или добавить в настройки?]*
*   **FR-4.3:** Табличная часть "Товары" в КП должна быть заполнена номенклатурой на основе входящих данных.
    *   **Номенклатура:** Определяется путем поиска в справочнике "Номенклатура" по полю `Артикул`, равному `Код` из входящих данных.
    *   **Количество:** Берется из входящих данных.
    *   **Цена:** Рассчитывается автоматически системой УТ согласно выбранному Виду цен и Соглашению.

### 4.4. Логирование и обработка ошибок

*   **FR-5.1:** Необходимо вести **журнал регистрации** операций загрузки (`РУТ_Обмен_ЖурналЗагрузок`).
*   **FR-5.2:** В журнал должны записываться: дата/время, статус ("Успешно", "Ошибка"), внешний номер заказа, ссылка на созданную Сделку, текст ошибки (при наличии).
*   **FR-5.3:** В случае ошибки при обработке одного заказа (например, не найден артикул), обработка не должна прерываться полностью. Ошибочный заказ пропускается, информация об ошибке заносится в журнал, а обработка продолжается для следующих заказов.

## 5. Нефункциональные требования

*   **NFR-1:** Все изменения должны быть выполнены исключительно через **расширение**.
*   **NFR-2:** При отключенном расширении не должно возникать ошибок в штатной работе конфигурации.
*   **NFR-3:** Производительность: Обработка пакета из 50 заказов не должна занимать более 2 минут.
*   **NFR-4:** Интерфейс обработок должен быть интуитивно понятным и соответствовать стилю УТ 11.5.
*   **NFR-5:** Код должен содержать комментарии на русском языке для ключевых алгоритмов.

## 6. Описание изменений в объектах конфигурации

### 6.1. Новые объекты
| Тип объекта | Имя объекта (в расширении) | Назначение |
|-------------|----------------------------|------------|
| Справочник | `РУТ_Обмен_Настройки` | Хранение параметров обмена |
| Документ | `РУТ_Обмен_ЖурналЗагрузок` | Логирование операций загрузки |
| Обработка | `РУТ_Обмен_ЗагрузкаЗаказов` | Основная обработка для загрузки |
| Обработка | `РУТ_Обмен_НастройкаПараметров` | Форма настройки параметров |

### 6.2. Изменяемые объекты
*Изменения в типовых объектах осуществляются через подсистему расширений (добавление реквизитов, кнопок и т.д.).*
| Объект УТ | Тип изменения | Детали |
|-----------|---------------|--------|
| Панель навигации | Добавление пункта | Добавить группу "Обмен с сайтом" с ссылками на обработки загрузки и настройки. |

## 7. Требования к интерфейсу

*   Обработка "Загрузка заказов с сайта" должна иметь основную форму с:
    *   Поле для выбора файла или ввода URL.
    *   Кнопки "Загрузить и обработать", "Показать журнал".
    *   Индикатор прогресса обработки.
    *   Поле для вывода краткого итога (обработано/ошибок).
*   Ссылки на обработки должны быть выведены в интерфейс УТ (например, в раздел "Продажи").

## 8. Этапы разработки и приемки

1.  **Этап 1 (Проектирование и ТЗ):** Согласование данного ТЗ. **Срок: 1 день.**
2.  **Этап 2 (Каркас расширения):** Создание структуры расширения, справочника настроек, журнала регистрации. **Срок: 2 дня.**
3.  **Этап 3 (Ядро загрузки):** Разработка логики парсинга входящих данных и создания Сделок с заполнением по правилам. **Срок: 3 дня.**
4.  **Этап 4 (Создание КП):** Разработка логики автоматического создания Коммерческих предложений. **Срок: 2 дня.**
5.  **Этап 5 (Интерфейс и доработки):** Создание форм обработок, интеграция в интерфейс, доработка логирования. **Срок: 2 дня.**
6.  **Этап 6 (Тестирование):** Внутреннее тестирование на тестовой базе. **Срок: 2 дня.**
7.  **Этап 7 (Пилотное внедрение):** Развертывание на production, проведение пробной загрузки под контролем пользователя. **Срок: 1 день.**
8.  **Этап 8 (Сдача проекта):** Подписание акта выполненных работ. **Срок: 1 день.**

---
## 9. Открытые вопросы (Требуют уточнения)

1.  Как определяется **Склад** для Коммерческого предложения?
2.  Какой **формат данных (JSON/XML)** и точная структура ожидается от сайта? *(Необходим пример файла)*.
3.  Нужна ли возможность **обратной выгрузки статусов** заказов на сайт?
4.  Требуется ли **авторизация** при обращении к веб-сервису сайта?

## 10. Подписание сторон

**Исполнитель:**
_________________ / *[ФИО, должность]* / *[Дата]*

**Заказчик/Представитель:**
_________________ / *[ФИО, должность]* / *[Дата]*